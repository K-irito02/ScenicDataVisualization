# 景区数据分析系统JMeter测试步骤

## 一、准备工作

### 1. 运行环境准备
1. 确保Django后端服务正常运行：
   ```bash
   cd /c:/Users/31432/Desktop/ScenicDataVisualization/backend
   python manage.py runserver
   ```

2. 确保前端服务正常运行：
   ```bash
   cd /c:/Users/31432/Desktop/ScenicDataVisualization/forward/my-forward
   npm run dev
   ```

### 2. JMeter安装与配置
1. 确保已安装JMeter 5.6或更高版本
2. 启动JMeter：双击`bin/jmeter.bat`文件
3. 设置中文界面：选择菜单`选项 → 选择语言 → 中文`

## 二、创建基础测试计划

### 1. 创建测试计划
1. 右键点击测试计划 → 重命名为"景区数据分析系统测试"
2. 勾选"独立运行每个线程组"选项

### 2. 添加线程组
1. 右键点击测试计划 → 添加 → 线程(用户) → 线程组
2. 设置参数：
   - 名称：`API测试线程组`
   - 线程数：10（模拟用户数）
   - 循环次数：5
   - 启动时间：1（秒）

### 3. 添加HTTP请求默认值
1. 右键点击测试计划 → 添加 → 配置元件 → HTTP请求默认值
2. 设置参数：
   - 协议：`http`
   - 服务器名称或IP：`localhost`
   - 端口号：`8000`（Django后端端口）

### 4. 添加Cookie管理器
1. 右键点击测试计划 → 添加 → 配置元件 → HTTP Cookie管理器
2. 勾选"清除每次迭代的cookie"

### 5. 添加HTTP信息头管理器（默认）
1. 右键点击测试计划 → 添加 → 配置元件 → HTTP信息头管理器
2. 添加以下信息头：
   ```
   Content-Type: application/json
   Accept: application/json
   ```

## 三、创建认证相关测试

### 1. 用户注册测试
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`用户注册`
   - 方法：`POST`
   - 路径：`/api/register/`
   - 内容类型：`application/json`
   - 请求体（Body Data）：
     ```json
     {
       "username": "testuser${__time()}",
       "password": "Test@123456",
       "email": "test${__time()}@example.com"
     }
     ```

3. 添加JSON提取器
   - 右键点击注册请求 → 添加 → 后置处理器 → JSON提取器
   - 参数设置：
     - 名称：`提取用户名`
     - 引用名称：`username`
     - JSON路径表达式：`$.username`
     - 匹配规则：默认

### 2. 用户登录测试（修复415错误）
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`用户登录`
   - 方法：`POST`
   - 路径：`/api/login/`
   - Body Data：
     ```json
     {
       "username": "${username}",
       "password": "Test@123456"
     }
     ```
   - 添加HTTP信息头管理器：
     - 右键点击登录请求 → 添加 → 配置元件 → HTTP信息头管理器
     - 添加以下信息头：
       ```
       Content-Type: application/json
       ```

3. 添加JSON提取器以获取认证令牌
   - 右键点击登录请求 → 添加 → 后置处理器 → JSON提取器
   - 参数设置：
     - 名称：`提取认证令牌`
     - 引用名称：`token`
     - JSON路径表达式：`$.token`
     - 匹配规则：默认

4. 添加响应断言
   - 右键点击登录请求 → 添加 → 断言 → 响应断言
   - 设置参数：
     - 测试字段：`响应文本`
     - 模式匹配规则：`包括`
     - 要测试的模式：`token`

## 四、景区数据API测试

### 1. 获取景区列表测试
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`获取景区列表`
   - 方法：`GET`
   - 路径：`/api/scenic-areas/`
   - 添加HTTP信息头管理器：
     - 右键点击请求 → 添加 → 配置元件 → HTTP信息头管理器
     - 添加以下信息头：
       ```
       Authorization: Bearer ${token}
       ```

3. 添加JSON提取器获取第一个景区ID
   - 右键点击请求 → 添加 → 后置处理器 → JSON提取器
   - 参数设置：
     - 名称：`提取景区ID`
     - 引用名称：`scenic_id`
     - JSON路径表达式：`$[0].id`
     - 匹配规则：默认

### 2. 获取单个景区详情测试
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`获取景区详情`
   - 方法：`GET`
   - 路径：`/api/scenic-areas/${scenic_id}/`
   - 添加HTTP信息头管理器，包含认证令牌

### 3. 景区收藏测试（修复401错误）
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`添加景区收藏`
   - 方法：`POST`
   - 路径：`/api/favorites/`
   - Body Data：
     ```json
     {
       "scenic_area_id": ${scenic_id}
     }
     ```
   - 添加HTTP信息头管理器：
     - 右键点击请求 → 添加 → 配置元件 → HTTP信息头管理器
     - 添加以下信息头：
       ```
       Content-Type: application/json
       Authorization: Bearer ${token}
       ```

### 4. 获取用户收藏列表测试
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`获取收藏列表`
   - 方法：`GET`
   - 路径：`/api/favorites/`
   - 添加HTTP信息头管理器，包含认证令牌

## 五、用户资料API测试

### 1. 获取用户资料测试
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`获取用户资料`
   - 方法：`GET`
   - 路径：`/api/users/profile/`
   - 添加HTTP信息头管理器，包含认证令牌

### 2. 更新用户资料测试
1. 右键点击线程组 → 添加 → 取样器 → HTTP请求
2. 设置参数：
   - 名称：`更新用户资料`
   - 方法：`PATCH`
   - 路径：`/api/users/profile/`
   - Body Data：
     ```json
     {
       "nickname": "测试用户${__time()}"
     }
     ```
   - 添加HTTP信息头管理器，包含认证令牌

## 六、高级测试场景

### 1. 性能测试配置（景区列表）
1. 右键点击测试计划 → 添加 → 线程(用户) → 线程组
2. 设置参数：
   - 名称：`性能测试线程组`
   - 线程数：50（并发用户）
   - 循环次数：20
   - 启动时间：5（秒）

3. 添加HTTP请求
   - 名称：`景区列表性能测试`
   - 方法：`GET`
   - 路径：`/api/scenic-areas/`

### 2. 使用CSV数据文件进行参数化测试
1. 创建CSV文件（users.csv）：
   ```
   username,password
   testuser1,Test@123456
   testuser2,Test@123456
   testuser3,Test@123456
   ```

2. 右键点击测试计划 → 添加 → 配置元件 → CSV数据文件设置
   - 名称：`用户数据`
   - 文件名：`users.csv`的完整路径
   - 变量名称：`username,password`

3. 修改登录请求使用CSV数据：
   ```json
   {
     "username": "${username}",
     "password": "${password}"
   }
   ```

## 七、监听结果与报告

### 1. 添加结果查看器
1. 右键点击测试计划 → 添加 → 监听器 → 查看结果树
2. 右键点击测试计划 → 添加 → 监听器 → 聚合报告
3. 右键点击测试计划 → 添加 → 监听器 → 图形结果

### 2. 生成HTML报告
在命令行中执行：
```bash
jmeter -n -t 景区数据分析系统测试.jmx -l results.jtl -e -o 报告文件夹
```

## 八、常见问题解决方案

### 1. 415错误（不支持的媒体类型）
- 确保设置了正确的`Content-Type`头为`application/json`
- 确保请求体是有效的JSON格式
- 确保没有额外的空格或换行符

### 2. 401错误（未授权）
- 确保认证令牌正确获取（检查提取器配置）
- 确保`Authorization`头格式正确：`Bearer {token}`
- 检查令牌是否过期

### 3. 请求无响应或超时
- 确认服务器正在运行
- 检查端口号配置是否正确
- 增加超时设置值

### 4. 变量提取失败
- 使用"调试取样器"来检查变量是否正确提取
- 检查JSON路径表达式是否正确
- 查看原始响应，确认期望数据存在

## 九、测试执行与分析

### 1. 执行测试
1. 点击运行按钮（绿色三角形）开始测试
2. 查看结果树中的请求状态
3. 分析聚合报告中的性能指标

### 2. 分析关键指标
- 平均响应时间：最理想小于500ms
- 错误率：应保持在5%以下
- 吞吐量：衡量系统每秒处理的请求数
- 90%/95%/99%响应时间：确保绝大多数用户体验良好

### 3. 报告解读
- 观察不同请求类型的性能差异
- 识别性能瓶颈点
- 比较不同并发用户数下的系统表现
